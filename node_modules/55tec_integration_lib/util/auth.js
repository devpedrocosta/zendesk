"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
const index_1 = require("../model/index");
const index_2 = require("../model/metadata/action/index");
const entity_1 = require("../model/metadata/action/entity");
const operation_1 = require("../model/metadata/action/operation");
class Auth {
    constructor(integrationClient) {
        this.integrationClient = integrationClient;
    }
    static makeToken(clientId) {
        return jsonwebtoken_1.default.sign({ client_id: clientId }, process.env.JWT_SECRET || '', { expiresIn: 86400000 });
    }
    async getClient(search) {
        const { credentials, clientId } = search;
        const response = await this.integrationClient.send(index_1.Integration.ADMIN, index_2.newAction(entity_1.Entity.Client, operation_1.Operation.FIND), {
            data: {
                clientId
            },
            credentials
        });
        return response.data;
    }
    async getAuthToken(search) {
        const { clientId } = await this.getClient(search);
        return Auth.makeToken(clientId);
    }
}
exports.default = Auth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxnRUFBK0I7QUFFL0IsMENBQTJDO0FBQzNDLDBEQUF5RDtBQUN6RCw0REFBdUQ7QUFDdkQsa0VBQW1FO0FBUW5FLE1BQXFCLElBQUk7SUFJckIsWUFBWSxpQkFBb0M7UUFDNUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDO0lBQy9DLENBQUM7SUFFRCxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQWdCO1FBQzdCLE9BQU8sc0JBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFHLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDckcsQ0FBQztJQUVELEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBYztRQUMxQixNQUFNLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sQ0FBQztRQUV6QyxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQzlDLG1CQUFXLENBQUMsS0FBSyxFQUNqQixpQkFBUyxDQUFDLGVBQU0sQ0FBQyxNQUFNLEVBQUUscUJBQUUsQ0FBQyxJQUFJLENBQUMsRUFDakM7WUFDSSxJQUFJLEVBQUU7Z0JBQ0YsUUFBUTthQUNYO1lBQ0QsV0FBVztTQUNkLENBQ3lELENBQUM7UUFFL0QsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQWM7UUFDN0IsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVsRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDcEMsQ0FBQztDQUNKO0FBbENELHVCQWtDQyJ9